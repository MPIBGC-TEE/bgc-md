## vim:set ff=unix expandtab ts=4 sw=4:
#This file should be changed to the new format
name: Henin's model
version: 1
entryAuthor: "Holger Metzler"
entryAuthorOrcid: 0000-0002-8239-1601
entryCreationDate: 09/03/2016
lastModification: _lm_
#modApproach: 
#partitioningScheme: 
#spaceScale: global 
#    unit: "1Â°"
timeResolution: annual
doi:
abstract: 

bibtex: "@inproceedings{Henin1945Annalesagronomiques,
             author = {H\\'{e}nin, S and Dupuis, M},
             booktitle = {Annales agronomiques},
             pages = {17--29},
             title = {{Essai de bilan de la mati\\`{e}re organique du sol}},
             volume = {15},
             year = {1945}
            }"

# the model section should be simplified in the following ways:
# 1. there is now only one subsection: variables
#    If a veriable has special meaning is decided by the keys or the context
#    The keys are more general than the subsections
#    - the state vector gets the key statevactor
#    - A state variable can be identified by looking at the state vector)
#    - A variable that is not a statevariable is a parameter if it is supplied
#      in a paramter set
#    - An external driver is a variable for which an external function is 
#      supplied in the func_set
# 2. The variables that are defined by an expression should not repeat their name in the expression
#    The part left of the equal sign is obsolete.
#
#'model' is hardcoded in python
model:
    # The componentscheme Variable is new. 
    # It determines from which constituents the reservoir model is to be constructed
    - componentscheme: "Fluxes"

    # the classification as statevariables is actually duplication 
    # it is here until we get it running without 
    - state_variables:
        - A:
            desc: labile pool
#            key: "foliage"
            unit: "MgC*ha^{-1}" 
        - B: 
            desc: stable pool
#            key: "wood"
            unit: "MgC*ha^{-1}" 
    
    - other_variables:
        - alpha:
            desc: annual decomposition rate of labile pool
            unit: "yr^{-1}"
            type: parameter
        - beta:
            desc: annual decomposition rate of stable pool
            unit: "yr^{-1}"
            type: parameter

        - m:
            desc: annual organic matter input
            unit: "MgC yr^{-1}"
            type: parameter

        - K:
            desc: isohumic coefficient
            type: parameter
        
    # the components subsection is actually also unwanted 
    # but difficult to change at the moments (see above:1)
    - components:
        # from here the essentials of a compartmental model are defined
        - C: 
            exprs: "C=Matrix(2,1,[A,B])"
            key: 'state_vector'
        # fluxes are normal variables that have :
        # internal fluxes have source and target
        - F1:
            source: A
            target: B
            exprs: "F1=alpha*K*A"
            key: 'internal_flux' 
            # I would also like to get rid of the key for a the fluxex
            # since it could be defined as a variable that has a source and a target 
            # but at the moment the implementation of the compartmental model 
            # relies havily on keys. This can be used to spot inconsistencies

        # external inputs have only a target
        - F2:
            target: A
            exprs: "F2=m"
            key: 'external_input_flux'
        # external outputs have only a source
        - F3:
            source: A 
            exprs: "F3=alpha*A"
            key: 'external_output_flux'
        - F4:
            source: B
            exprs: "F3=beta*B"
            key: 'external_output_flux'

        #

            #        - I:
            #            desc: input vector
            #            exprs: "I = Matrix(2, 1, [m,0])"
            #            key: input_vector
            #        - A_GeM:
            #            desc: decomposition operator
            #            exprs: "A_GeM = Matrix(2, 2, [-alpha, 0, alpha*K, -beta])"
            #            key: decomp_op_lin
            #        - f_s: 
            #            exprs: "f_s = I+A_GeM*C"
            #            desc: the right hand side of the ode
            #            key: state_vector_derivative

#    - parameter_sets:
# there are some in the paper, but at first glance I don't see how to translate them to this model structure
