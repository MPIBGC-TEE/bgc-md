<!DOCTYPE html>
<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	</head>
<body>
	
<h2>This is a heading</h2>
The problem with this prototype is that the select fields need a unique identifier
that survives all adding and deleting rows repeatedly

Also the deletion of rows does not work properly.
After a row is added or deleted all form fields should be renumbered with respect to the new table position
<div id="TableDiv"> </div>
<p>
tableLengthDemo
<div id="tableLengthDemo"> </div>
</p>
<div id="demo_ids"> </div>
<div id="demo_selind"> </div>
<div id="demo_l"> </div>
<div id="demo_divTarget"> </div>
<p> <div id="AddButtonDiv"> </div> </p>
<p> <div id="SubmitButtonDiv"> </div> </p>

<script>
  var select_ids=['ss1','ss2'];
  var div_ids=['targetDiv12','targetDiv22'];

  var add_button = document.createElement("INPUT");
  add_button.setAttribute("type", "button");
  add_button.setAttribute("value", "add flux");
  //add_button.setAttribute("onclick","addRow(['x_1','x_2'],1)");
  add_button.setAttribute("onclick","addLastRow()");
  document.getElementById('AddButtonDiv').appendChild(add_button);

  //var submit_button= document.createElement("INPUT");
  //submit_button.setAttribute("type", "submit");
  //submit_button.setAttribute("value","save");
  //document.getElementById('SubmitButtonDiv').appendChild(submit_button);

  var names=['x_1','x_2','x_3','x_4'];
  var fluxes=[['x_1','x_2'],['x_2','x_4'],['x_3','x_4'],['x_4','x_1']];
  //prepare the table for the fluxforms
  var T =document.createElement('TABLE');
  //var T=document.getElementById('FluxTable')
  var row =document.createElement("TR");
	row.setAttribute('id','table_row_'+(1))
  var th1=document.createElement("TH");
  th1.appendChild(document.createTextNode("Source"));
  
  var th2=document.createElement("TH")
  th2.appendChild(document.createTextNode("Target"));
  
  var th3=document.createElement("TH")
  th3.appendChild(document.createTextNode("Expression"));
  
  row.appendChild(th1);
  row.appendChild(th2);
  row.appendChild(th3);
  T.appendChild(row);
  //add.style.width="300px"
  
  
 
  del_maker=function(id){
  	//var i=row.parentNode.rowIndex;
  	return function() {
		row=document.getElementById(id)
  		var i=row.parentNode.rowIndex;
		T.deleteRow(i)
	};
  };
   
  	
  
  function createSelect(names,selected_value,ind) {
      
      var x = document.createElement("SELECT")
      x.setAttribute('ind',ind);
      x.setAttribute('id','SourceSelect_'+ind);
      var txt = "";
      var i;
      for (i = 0; i < names.length; i++) {
  	var item=names[i];
          var o = document.createElement("OPTION");
  	o.setAttribute("value",item);
          var t=document.createTextNode(item);
  	o.appendChild(t);
  	x.appendChild(o);
      }
      x.selectedIndex=names.indexOf(selected_value);
      return x;
  }
  function update(ids,div_target){
  	var ts=ids.cloneNode(true);
	var ind=ids.getAttribute('ind')
	ts.setAttribute('id','TargetSelect_'+ind)
  	var selind=ids.selectedIndex;
  	document.getElementById('demo_selind').innerHTML=selind;
  	ts.remove(selind);
      	l=div_target.childNodes.length;
      	document.getElementById("demo_l").appendChild(document.createTextNode(l));
      	if (l > 0){
      	    oldf=div_target.childNodes[0]
      	    div_target.replaceChild(ts,oldf);
      	}
      	if (l == 0){
      	    div_target.appendChild(ts);
      	}
  };

  update_maker=function(sf,td){
		var f=function() {
			update(sf,td);
		};
		return f;
  };
  function addRow(flux,ind){
  	var s=flux[0];
  	sf=createSelect(names,s,ind);
  	var t=flux[1];
  	var tf  =document.createTextNode(t);
  	var row =document.createElement("TR");
	row.setAttribute('id','table_row_'+(ind+2))
  	var sd  =document.createElement("TD");
  
  	sd.appendChild(sf);
  	td =document.createElement("TD");
  
  	update(sf,td);
  	var exp=document.createElement("INPUT");
  	exp.id="expression_"+ind;
  	T.appendChild(row);
  	var f=update_maker(sf,td);
  	sf.oninput=f;
  
  	bd =document.createElement("TD");
  	var b= document.createElement("INPUT");
  	b.setAttribute('type','button');
  	var nr=T.rows.length;
  	b.setAttribute('value','delete flux'+row.id);
  	// since at this moment the row has not yet been added the 
  	// rowcount yields the right index
	var rw=row.id
  	var del=del_maker(rw);
  	b.onclick=del
  	bd.appendChild(b);
  	row.appendChild(sd);
  	row.appendChild(td);
  	row.appendChild(exp);
  	row.appendChild(bd);
  }
  function addLastRow(){
	  var tld=document.getElementById("tableLengthDemo")
	  var l=T.rows.length;
	  tld.innerHTML=l;
  }
  function main(){
  	//create the flux selects for the given fluxes
  	fluxes.forEach(addRow);
  	//document.body.appendChild(T);
  	TD=document.getElementById("TableDiv");
  	TD.appendChild(T);
  
  }
  
  document.onload=main();
</script>
	
</body>
</html>


