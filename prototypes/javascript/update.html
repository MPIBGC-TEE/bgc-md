<!DOCTYPE html>
<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script>
			$(document).ready(function(){
				    $("select").change(function(e){

    					    var id = $(this).attr("id");
    					    var value = this.value;

    					    $("select option").each(function(){

    					        var idParent = $(this).parent().attr("id");
    					    		
    					        if(id != idParent){
    					            if(this.value == value){
    					                this.disabled = true;
    					                
    					            }
    					            
    					            else if($("#box_g1 option:selected").val()!="Default"){
    					                
    					                
    					                $("#box_g2").prop("disabled", false);
    					                $("#box_g3").prop("disabled", false);
    					    	     $("#box_g4").prop("disabled", false);
    					                $("#box_g5").prop("disabled", false);
    					            }else{
    					                
    					                
    					                
    					                defaultValues();
    					            }
    					        }
    					    });
    					});

 			});
	function defaultValues() {
		if ($("#box_g1").val() == "Default") {

			$('select[id^="box_g"] option').prop("disabled",false);

            		$("#box_g2").attr("disabled", true).val('Disabled');

			$("#box_g3").attr("disabled", true).val('Disabled');

			$("#box_g4").attr("disabled", true).val('Disabled');

			$("#box_g5").attr("disabled", true).val('Disabled');

		} else {
			$("#box_g2").attr("disabled", false);
			$("#box_g3").attr("disabled", false);
			$("#box_g4").attr("disabled", false);
			$("#box_g5").attr("disabled", false);
		}
	}

		</script>
	</head>
<body>
	
<h2>This is a heading</h2>

<select name="n1" id="box_g1" onChange="dynamicSelect(this)">
	<option value="Default">Default</option>
	<option value="A">A</option>
	<option value="B">B</option>
	<option value="C">C</option>
	<option value="D">D</option>
	<option value="E">E</option>
</select>

<select name="n2" id="box_g2" disabled="disabled"
	onChange="dynamicSelect(this)">
	<option value="Disabled">Disabled</option>
	<option value="A">A</option>
	<option value="B">B</option>
	<option value="C">C</option>
	<option value="D">D</option>
	<option value="E">E</option>
</select>

<select name="n3" id="box_g3" disabled="disabled"
	onChange="dynamicSelect(this)">
	<option value="Disabled">Disabled</option>
	<option value="A">A</option>
	<option value="B">B</option>
	<option value="C">C</option>
	<option value="D">D</option>
	<option value="E">E</option>
</select>
<select name="n4" id="box_g4" disabled="disabled"
	onChange="dynamicSelect(this)">
	<option value="Disabled">Disabled</option>
	<option value="A">A</option>
	<option value="B">B</option>
	<option value="C">C</option>
	<option value="D">D</option>
	<option value="E">E</option>

</select>
<select name="n5" id="box_g5" disabled="disabled"
	onChange="dynamicSelect(this)">
	<option value="Disabled">Disabled</option>
	<option value="A">A</option>
	<option value="B">B</option>
	<option value="C">C</option>
	<option value="D">D</option>
	<option value="E">E</option>

</select>	

<form id="sf1">
 <table id='fluxtable' style="width:50%">
  <tr>
    <th>Source</th>
    <th>Target</th>
    <th>Action</th>
  </tr>
  <tr>
    <td>
	<select id="ss1" oninput="update_id('ss1','targetDiv12')">
	  <option>C_1</option>
	  <option>C_2</option>
	  <option>C_3</option>
	  <option>C_4</option>
	</select>
    </td>
    <td><div id="targetDiv12"> </div></td>
    <td><div id="targetDiv13"> </div></td>
  </tr>
    <td>
	<select id="ss2"  oninput="update_id('ss2','targetDiv22')">
	  <option>C_1</option>
	  <option>C_2</option>
	  <option>C_3</option>
	  <option>C_4</option>
	</select>
    </td>
    <td><div id="targetDiv22"> </div></td>
    <td><div id="targetDiv23"> </div></td>
  <tr>
  </tr>
 </table> 	
	<input type="button" onclick='deletetr()'> delete </input>
</form>
<div id="demo_f"> </div>
<div id="demo_ids"> </div>
<div id="demo_selind"> </div>
<div id="demo_l"> </div>
<div id="demo_divTarget"> </div>
<script>
	var select_ids=['ss1','ss2'];
	var div_ids=['targetDiv12','targetDiv22'];
	var names=['x_1','x_2','x_3','x_4'];
	var fluxes=[['x_1','x_2'],['x_3','x_4'],['x_1','x_3'],['x_2','x_4']];
	//prepare the table for the fluxforms
	var T =document.createElement('TABLE');
	T.id='fluxTable';
	var row =document.createElement("TR");
	var th1=document.createElement("TH");
	th1.appendChild(document.createTextNode("Source"));

	var th2=document.createElement("TH")
	th2.appendChild(document.createTextNode("Target"));
	
	var th3=document.createElement("TH")
	th3.appendChild(document.createTextNode("Expression"));

	row.appendChild(th1);
	row.appendChild(th2);
	row.appendChild(th3);
	T.appendChild(row);
 
  del_maker=function(row){
		var i=row.parentNode.rowIndex;
		return function() { T.deleteRow(i)};
	};
	 
	function deletetr(n){
		T.deleteRow(n);
	};
		
	
	function createSelect(names,selected_value) {
	    
	    var x = document.createElement("SELECT")
	    x.setAttribute('id','targetSelect');
	    var txt = "";
	    var i;
	    for (i = 0; i < names.length; i++) {
		var item=names[i];
	        var o = document.createElement("OPTION");
		o.setAttribute("value",item);
	        var t=document.createTextNode(item);
		o.appendChild(t);
		x.appendChild(o);
	    }
	    x.selectedIndex=names.indexOf(selected_value);
	    return x;
	}
	function update(ids,div_target){
		var ts=ids.cloneNode(true);
		var selind=ids.selectedIndex;
		document.getElementById('demo_selind').innerHTML=selind;
		ts.remove(selind);
	    	l=div_target.childNodes.length;
	    	document.getElementById("demo_l").appendChild(document.createTextNode(l));
	    	if (l > 0){
	    	    oldf=div_target.childNodes[0]
	    	    div_target.replaceChild(ts,oldf);
	    	}
	    	if (l == 0){
	    	    div_target.appendChild(ts);
	    	}
	};
	function update_id(select_id,div_id){
	  document.getElementById("demo_ids").appendChild(select_id);
		var ids=document.getElementById(select_id);
		var div_target=document.getElementById(div_id);
	  document.getElementById("demo_divTarget").innerHTML = div_id;
		update(ids,div_target)
	};

  update_maker=function(sf,td){
		var f=function() {
			update(sf,td);
		};
		return f;
  };
	function main(){
		function addRow(flux,ind){
			var s=flux[0];
			sf=createSelect(names,s);
			var t=flux[1];
			var tf  =document.createTextNode(t);
			var row =document.createElement("TR");
			var sd  =document.createElement("TD");
	
			sd.appendChild(sf);
			td =document.createElement("TD");

			update(sf,td);
			var exp=document.createElement("INPUT");
			exp.id="exp_"+ind;
			T.appendChild(row);
			var f=update_maker(sf,td);
			sf.oninput=f;

			bd =document.createElement("TD");
			var b= document.createElement("INPUT");
			b.setAttribute('type','button');
      var nr=T.rows.length;
			b.setAttribute('value','delete flux'+nr);
			// since at this moment the row has not yet been added the 
			// rowcount yields the right index
			var del=del_maker(row);
			b.onclick=del
			bd.appendChild(b);
			row.appendChild(sd);
			row.appendChild(td);
			row.appendChild(exp);
			row.appendChild(bd);
		}
		fluxes.forEach(addRow);
		document.body.appendChild(T);
		var add = document.createElement("INPUT");
		add.setAttribute("type", "button");
		add.setAttribute("value", "add flux");
		//add.style.width="300px"
		var row_add=document.createElement("TR");
		var td_add =document.createElement("TD");
		td_add.colSpan=4;
		td_add.appendChild(add);
		row_add.appendChild(td_add);
		T.appendChild(row_add);

		var row_sub =document.createElement("TR");
		var sub= document.createElement("INPUT");
		sub.setAttribute("type", "submit");
		sub.setAttribute("value","save");
		var tdl =document.createElement("TD");
		tdl.appendChild(sub);
		row_sub.appendChild(tdl);
		T.appendChild(row_sub);
	}
	
	document.onload=main();
</script>
	
</body>
</html>


